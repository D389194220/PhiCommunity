(()=>{"use strict";var e={4489:(e,t,o)=>{e.exports=o.p+"assets/LevelOver0.78f9.ogg"},870:(e,t,o)=>{e.exports=o.p+"assets/LevelOver1.83d3.ogg"},393:(e,t,o)=>{e.exports=o.p+"assets/LevelOver2.d36e.ogg"},124:(e,t,o)=>{e.exports=o.p+"assets/LevelOver3.ad57.ogg"}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,o),n.exports}o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../"})(),(()=>{var e=o(4489),t=o(870),r=o(393),a=o(124);const n={ez:0,hd:1,in:2,at:3};window.addEventListener("DOMContentLoaded",(()=>{document.querySelector("div#avatarBar").addEventListener("click",(e=>{var t=e.target;null==t.classList.toString().match("avatarBar")&&(t=e.target.parentElement),t.classList.toString().match("expand")?t.classList.remove("expand"):t.classList.add("expand")})),null!=window.localStorage.getItem("playerName")&&(console.log("Setting player name: ",window.localStorage.getItem("playerName")),document.querySelector("div#avatarBar").setAttribute("data-name",window.localStorage.getItem("playerName"))),null!=window.localStorage.getItem("playerAvatar")&&(console.log("Setting player avatar: ",window.localStorage.getItem("playerAvatar")),document.querySelector("div#avatarBar").children[0].setAttribute("style",'--avatar: url("'+window.localStorage.getItem("playerAvatar")+'");'));const o=sessionStorage.getItem("play"),s=sessionStorage.getItem("level"),l=n[s],c=parseInt(sessionStorage.getItem("score")),i=sessionStorage.getItem("maxCombo"),d=sessionStorage.getItem("perfect"),u=sessionStorage.getItem("good"),g=sessionStorage.getItem("early"),m=sessionStorage.getItem("bad"),p=sessionStorage.getItem("miss"),w=sessionStorage.getItem("mode");switch(sessionStorage.clear(),w){case"normal":default:break;case"auto":document.querySelector("#scrollFrame").classList.add("auto");break;case"hyper":document.querySelector("#scrollFrame").classList.add("hyper")}const y=Math.round((parseInt(d)+.65*parseInt(u))/(parseInt(d)+parseInt(u)+parseInt(m)+parseInt(p)+0)*1e4)/100,S=u-g;var v;document.getElementById("retryBtn").addEventListener("click",(()=>{window.actx.close(),location.href="../whilePlaying/index.html?play="+o+"&l="+s})),document.getElementById("backInResultBtn").addEventListener("click",(()=>{window.actx.close(),location.href="../songSelect/index.html"})),0==c&&(console.log("No grade"),v=""),c<699999&&0!=c&&(console.log("Grade: False"),v="F15F"),7e5<=c&&c<=819999&&(console.log("Grade:C"),v="C15C"),82e4<=c&&c<=879999&&(console.log("Grade:B"),v="B15B"),88e4<=c&&c<=919999&&(console.log("Grade:A"),v="A15A"),92e4<=c&&c<=959999&&(console.log("Grade:S"),v="S15S"),96e4<=c&&c<=999999&&(console.log("Grade:V"),v="V15V"),0==m&&0==p&&(console.log("Grade: V wih Full Combo"),v="V15FC"),1e6<=c&&(console.log("Grade:Phi"),v="phi15phi"),fetch("https://charts.phicommunity.com.cn/"+o+"/meta.json").then((e=>e.json())).then((n=>{window.window.playResult={score:c,grade:v,play:o,playLevel:l,songInfo:n,maxCombo:i,accuracy:y,perFect:d,good:u,bad:m,miss:p,early:g,late:S,playLevelString:s,mode:w},console.log(window.playResult);let h=e;switch(l){case 0:h=e;break;case 1:h=t;break;case 2:h=r;break;case 3:h=a}var x,I;fetch(h).then((e=>e.arrayBuffer())).then((e=>{window.actx=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext),window.actx.decodeAudioData(e,(function(e){var t=window.actx.createBufferSource();t.buffer=e,t.loop=!0,t.connect(window.actx.destination),t.start(0)}))})),document.body.setAttribute("style",`--background:url(${encodeURI("https://charts.phicommunity.com.cn/"+window.playResult.play+"/"+window.playResult.songInfo.illustration)});`),document.querySelector("#songImg").setAttribute("src",encodeURI("https://charts.phicommunity.com.cn/"+o+"/"+window.playResult.songInfo.illustration)),document.querySelector("#score").innerText=c.toString().padStart(7,"0"),document.querySelector("#gradeImage").src="../assets/images/"+v+".svg",document.querySelector("#maxCombo").innerText=i,document.querySelector("#accuracy").innerText=y+"%",document.querySelector("#perfect").innerText=d,document.querySelector("#good").innerText=u,document.querySelector("#bad").innerText=m,document.querySelector("#miss").innerText=p,document.querySelector("#early").innerText=g,document.querySelector("#late").innerText=S,document.querySelector("div.songName#songName").innerText=window.playResult.songInfo.name,document.querySelector("div.levelString#levelString").innerText=window.playResult.playLevelString.toUpperCase()+" Lv."+Math.floor(window.playResult.songInfo[window.playResult.playLevelString.toLowerCase()+"Ranking"]||0),x=window.playResult.accuracy>=70?(Math.pow((window.playResult.accuracy-55)/45,2)*(window.playResult.songInfo[window.playResult.playLevelString.toLowerCase()+"Ranking"]||0)).toFixed(2):0,window.playResult.score<88e4&&(I=0),document.querySelector("#rks").innerText=x,console.log("ΔRKS:",x),console.log("ΔData(KB):",I)})).catch((()=>{alert("歌曲信息获取失败！")}))}))})()})();