(()=>{"use strict";var e={724:(e,t,o)=>{e.exports=o.p+"assets/LevelOver.mp3"}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,o),a.exports}o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../"})(),(()=>{var e=o(724);const t={ez:0,hd:1,in:2,at:3};window.addEventListener("DOMContentLoaded",(()=>{document.querySelector("div#avatarBar").addEventListener("click",(e=>{var t=e.target;null==t.classList.toString().match("avatarBar")&&(t=e.target.parentElement),t.classList.toString().match("expand")?t.classList.remove("expand"):t.classList.add("expand")})),null!=window.localStorage.getItem("playerName")&&(console.log("Setting player name: ",window.localStorage.getItem("playerName")),document.querySelector("div#avatarBar").setAttribute("data-name",window.localStorage.getItem("playerName")));const o=new URL(location.href).search,n=new URLSearchParams(o),r=n.get("play"),a=t[n.get("l")],l=n.get("l"),c=parseInt(n.get("score")),s=n.get("mc"),i=n.get("p"),d=n.get("g"),u=n.get("b"),g=n.get("m"),p=n.get("e"),m=n.get("mode");switch(m){case"normal":default:break;case"auto":document.querySelector("#scrollFrame").classList.add("auto");break;case"hyper":document.querySelector("#scrollFrame").classList.add("hyper")}const w=Math.round((parseInt(i)+.65*parseInt(d))/(parseInt(i)+parseInt(d)+parseInt(u)+parseInt(g)+0)*1e4)/100,y=d-p;var h;document.getElementById("retryBtn").addEventListener("click",(()=>{window.actx.close(),location.href="../whilePlaying/index.html?play="+r+"&l="+l})),document.getElementById("backInResultBtn").addEventListener("click",(()=>{window.actx.close(),location.href="../songSelect/index.html"})),0==c&&(console.log("No grade"),h=""),c<699999&&0!=c&&(console.log("Grade: False"),h="F15F"),7e5<=c&&c<=819999&&(console.log("Grade:C"),h="C15C"),82e4<=c&&c<=879999&&(console.log("Grade:B"),h="B15B"),88e4<=c&&c<=919999&&(console.log("Grade:A"),h="A15A"),92e4<=c&&c<=959999&&(console.log("Grade:S"),h="S15S"),96e4<=c&&c<=999999&&(console.log("Grade:V"),h="V15V"),0==u&&0==g&&(console.log("Grade: V wih Full Combo"),h="V15FC"),1e6<=c&&(console.log("Grade:Phi"),h="phi15phi"),fetch("https://charts.phicommunity.com.cn/"+r+"/meta.json").then((e=>e.json())).then((t=>{var o,n;window.window.playResult={score:c,grade:h,play:r,playLevel:a,songInfo:t,maxCombo:s,accuracy:w,perFect:i,good:d,bad:u,miss:g,early:p,late:y,playLevelString:l,mode:m},console.log(window.playResult),fetch(e).then((e=>e.arrayBuffer())).then((e=>{window.actx=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext),window.actx.decodeAudioData(e,(function(e){var t=window.actx.createBufferSource();t.buffer=e,t.loop=!0,t.connect(window.actx.destination),t.start(0)}))})),document.body.setAttribute("style",`--background:url(${encodeURI("https://charts.phicommunity.com.cn/"+window.playResult.play+"/"+window.playResult.songInfo.illustration)});`),document.querySelector("#songImg").setAttribute("src",encodeURI("https://charts.phicommunity.com.cn/"+r+"/"+window.playResult.songInfo.illustration)),document.querySelector("#score").innerText=c.toString().padStart(7,"0"),document.querySelector("#gradeImage").src="../assets/images/"+h+".svg",document.querySelector("#maxCombo").innerText=s,document.querySelector("#accuracy").innerText=w+"%",document.querySelector("#perfect").innerText=i,document.querySelector("#good").innerText=d,document.querySelector("#bad").innerText=u,document.querySelector("#miss").innerText=g,document.querySelector("#early").innerText=p,document.querySelector("#late").innerText=y,document.querySelector("div.songName#songName").innerText=window.playResult.songInfo.name,document.querySelector("div.levelString#levelString").innerText=window.playResult.playLevelString.toUpperCase()+" Lv."+Math.floor(window.playResult.songInfo[window.playResult.playLevelString.toLowerCase()+"Ranking"]||0),o=window.playResult.accuracy>=70?(Math.pow((window.playResult.accuracy-55)/45,2)*(window.playResult.songInfo[window.playResult.playLevelString.toLowerCase()+"Ranking"]||0)).toFixed(2):0,window.playResult.score<88e4&&(n=0),document.querySelector("#rks").innerText=o,console.log("ΔRKS:",o),console.log("ΔData(KB):",n)})).catch((()=>{alert("歌曲信息获取失败！")}))}))})()})();